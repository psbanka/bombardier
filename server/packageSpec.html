<h1>Bombardier Package Specification v0.6</h1>

<h2> General Structure </h2>

<ul>

<li> The package file will have the following naming pattern:
     <strong>[packageName]-[packageVersion].spkg</strong> The
     "packageName" can be any free-form text letters of mixed case,
     numbers, dash (-) and underscore (_). The "packageVersion" is the
     revision of the package (an integer between 1 and 99). Clients will
     always choose the latest version of a package, but if a package
     is already installed, it will not uninstall and reinstall if a
     new revision of the package is made available.

<li> The package, while denoted with a '.spkg' extension is a
     compressed tarball that expands out to the following directory
     structure: 
     
     <ol>

     <li> The package should explode into a directory with the same
          name as the package file (minus the 'spkg' extension

     <li> The first level under the package directory
          <strong>must</strong> have a "scripts" directory. This
          directory will contain all scripts for installing,
          uninstalling, verifying, and backing up the package.

     <li> The scripts directory must contain an installer script. It
          must be named "installer" and must have an extension of
          either ".py", ".bat", or ".pl". This script will be run to
          install the package. When it's run, its working directory
          will be either the injector or the backup directory, as
          described below. The installer must return a zero exit code
          for Bombardier to accept that the installation proceeded
          properly. If the installer returns a 1, the installation
          will be declared a failure. If the installer returns a 2,
          Bombardier will reboot the system before continuing to
          install.

     <li> the scripts directory must contain a "verify" script. Again,
          it can have an extension of either ".py", ".bat", or
          ".pl". And should verify that as much as possible about the
          status of the package. Examples of things to do in a verify
          script: (1) verify md5sums of installed files, (2) verify
          registry entries, (3) verify file version information, (4)
          run a self-test program against the package. Any non-zero
          return code will be interpreted as a failed verification.

     <li> The scripts directory must contain an "uninstall" script
          (also with either of the three extensions). Return codes for
          this script are the same as with the installer script.

     <li> The scripts directory can optionally contain a "backup"
          script. This script is intended to create a backup of the
          package to be placed into the backup directory at the
          highest level of the package.

     <li> The first level under the package directory
          <strong>must</strong> also have either a "backup" or a
          "injector" directory. If both directories exist, the
          "backup" directory will be preferred over the "injector"
          directory. These directories must contain all necessary
          binaries or program files needed to install, uninstall, or
          back up the software.

     </ol>

</ul>

<h2> Package .ini file </h2>

<ul>

<li> All packages must have a <strong>package.ini</strong> file in the
     same level as the scripts and installer directories. This file is
     a standard .ini file, and must contain the following sections and
     options. 

     <ol>

     <li> The <strong>install</strong> section must have the following
     sections: 

          <ol>

          <li> console = TRUE or FALSE: This specifies whether or not
               the package requires the Windows system to be logged on
               with an administrator account. If so, the Bombardier
               system will log on to the system with the "serviceuser"
               account as defined in the localConfig.ini file before
               running the installer script.

          <li> reboot = TRUE or FALSE: This specifies that Bombardier
               should reboot after installing, regardless of the exit
               string provided by the installer script.

          <li> autoreboot = TRUE or FALSE: This specifies that
               Bombardier should assume that the package will try to
               reboot the system on its own. Therefore, Bombardier
               will not wait for an exit code of the script and will
               assume success after running the installer.

          <li> priority = [NUMBER]: This number indicates the relative
               priority of the package; Higher numbers are installed
               sooner than low numbers.

          <li> platform = [WIN2000PROFESSIONAL|WIN2000SERVER|ANY]: this
               specifies which platform this package is compatible
               with.

          </ol>

     <li> The optional <strong>dependencies</strong> section specifies
          the packages that this package depends on. These packages
          will be installed before this package, and if any of those
          packages is purposely removed, this package will also be
          scheduled for removal. Also, any dependencies, if they are a
          lower priority than this package, will inherit the priority
          level of this package. Dependencies are ennumerated in the
          .ini file as dep0=[pkgname], dep1=[pkgname], etc.

     <li> The optional <strong>config</strong> section specifies all
          of the configuration options that this package requires. Any
          package that relies on the configuration subsystem of
          Bombardier must list out all of the package configuration
          options in this section. The format of each entry under the
          config section is as follows: section,option=default. If
          there is no default, then this value can be left blank. For
          example, if a package called "MSDE" requires a configuration
          section called "MSDE", and looks for an option of
          "instanceName", with a default of "CDBA", the entry under
          the config section would be "MSDE,instanceName=CDBA". If a
          package "ipsettings" requires a configuration option under
          "system" with an option of "ipaddress", with no default
          should have an entry in the [config] section
          "system,ipaddress=" 

     </ol>   
</ul>

<h2> Backups </h2>

<ul>

<li> Packages with a "backup.py" file can be backed up. Those packages
     must also have a section in their package.ini called
     <strong>backup</strong>, underneath which there can be the
     following items:

     <ol>
     <li> <strong>rootname</strong> (mandatory) this specifies the
          base name of the package, for the purpose of pulling script
          files out of the source code repository.

     <li> <strong>databases</strong> (optional) for database packages,
          this is a comma-separated list of databases that this
          package will use and manipulate.

     <li> <strong>role</strong> (optional) for database packages,
          there are two possible roles: "data" and
          "structure". Structure packages are responsible for
          (1) creating the database upon installation and dropping the
          database upon uninstallation, (2) creating the table
          schemas, (3) setting up all code (user-defined functions and
          stored procedures, e.g.) (4) inserting all non-user data,
          (5) inserting or modifying all configuration data. Data
          packages are responsible for populating tables within the
          database when installing, and truncating tables when
          uninstalling. There could be more than one data package for
          a given database, but never multiple structure packages.

     <li> <strong>schedule</strong> (optional) for packages that
          require periodic backups, this field specifies the frequency
          that backups will occur. The format of this field must be
          one of the following: (1) "[number]m" -- this specifies the
          number of minutes that the system should wait between
          successful backups, (2) "[number]h" -- same, but the number
          of hours between successful backups, (3)
          "[mon|tue|wed|thu|fri|sat|sun|all] [hh]:[mm]" specifies the time
          and day of the week for all backups to occur.

     </ol>

<li> Backups will be done whenever a package is uninstalled. Recall
     that a package will be uninstalled for one of the following
     reasons (1) that package has been removed from the bill of
     materials for that system, or (2) that package's dependency has
     been removed -- or altered. One use-case of this type of
     uninstallation is if you are modifying the database schema out
     from under a data package. This will allow the database schema to
     be modified without disrupting data. The use case is as follows: 

     <ol>

     <li> The database structure package is modified in the system's
          bill of materials.

     <li> Bombardier on the client system will see that the old
          structure package must be removed and the data package that
          it's dependent upon must also be removed. 

     <li> The data package is first to be removed, and as such it is
          backed up first and placed on the repository. The data
          package will truncate all tables when it is uninstalled.

     <li> The out-of-date structure package is uninstalled, dropping
          the databases in question. The structure package does not
          require a backup

     <li> The new structure package is installed

     <li> The latest backup that was just performed is installed
          underneath the new structure package. 

     </ol>

<li> The backup process will upload data only (i.e. the "injector"
     directory). It will not upload any "scripts" data. The reason for
     this is that an administrator may decide to make modifications to
     the installation or verification or backup scripts for a given
     package. Furthermore, the svn repository should be the source of all
     code that is used to manage packages, and that code should not be
     propogated by other systems. Therefore, the client will upload a
     new tarball of data, and instruct the web service what the new
     name of the package will be called and where it can find the
     scripts in svn for building the package.

</ul>
     
